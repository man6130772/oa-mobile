define(["vue","common","css!iconfont","css!commoncss","css!detailformCSS"],function(t){function e(){var e,a=this;this.init=function(t,n,l){e=t.type,a.handleBackClick(),$("#"+n+" h1.title").text("明细"+getQueryString("detail")),a.handleControler(n),a.handleClock(n),a.handleSubmit(n)},this.render=function(e,a){return new t({el:"#"+e,data:{data:a||{}}})},this.ajaxData=function(t,e,a){$.getJSON(t,function(t){e.data=t,a&&a(e,t)})},this.handleBackClick=function(){$(".app-btn-back").off("click").on("click",function(){history.back()})},this.handleControler=function(t){function e(e){$.ajax({url:"../../resources/json/validDate.json",type:"POST",success:function(a){var n=$("#"+t+" .app-leave-valid-date"),l=$("#"+t+" .app-leave-remain"),i=n.find(".item-after");"调休"===e||"年假"===e?("调休"===e&&i.text(a.hours+"小时"),"年假"===e&&i.text(a.days+"天"),n.show(),l.show()):(n.hide(),l.hide())}})}$(document).on("click","#"+t+" .app-leave-type",function(){var a=[{text:"请选择",label:!0},{text:"调休",bold:!0,color:"default",onClick:function(){$("#"+t+" .app-leave-type .item-after").text(this.text),e("调休")}},{text:"年假",bold:!0,color:"default",onClick:function(){$("#"+t+" .app-leave-type .item-after").text(this.text),e("年假")}},{text:"事假",bold:!0,color:"default",onClick:function(){$("#"+t+" .app-leave-type .item-after").text(this.text),e("事假")}},{text:"病假",bold:!0,color:"default",onClick:function(){$("#"+t+" .app-leave-type .item-after").text(this.text),e("病假")}}],n=[{text:"取消",bg:"primary"}],l=[a,n];$.actions(l)}),e("调休")},this.handleClock=function(t){var e=function(t){for(var e=[],a=1;a<=(t||31);a++)e.push(a<10?"0"+a:a);return e},a=function(t,a){var n=new Date(a,parseInt(t)+1-1,1);return e(new Date(n-1).getDate())},n=function(t,e,n){var l=a(t.cols[1].value,t.cols[0].value),i=t.cols[2].value;i>l.length&&(i=l.length),t.cols[2].setValue(i)},l=function(){$.ajax({url:"../../resources/json/leaveLength.json",type:"POST",data:{type:$("#"+t+" .app-leave-type .item-after").text(),startTime:i.val(),endTime:o.val()},success:function(e){$("#"+t+" .app-leave-length .item-after").text(e.length+"小时"),$("#"+t+" .app-leave-remain .item-after").text(e.remain+"小时")}})},i=$("#"+t+" .app-leave-start-time input"),o=$("#"+t+" .app-leave-end-time input"),s=new Date,c=s.getFullYear(),r=s.getMonth()+1,u=s.getDate();r=r>10?r:"0"+r,u=u>10?u:"0"+u;var p='<header class="bar bar-nav">                                        <button class="button button-link pull-right close-picker">确定</button>                                        <h3 class="title text-left p-l-md">请选择时间：</h3>                                    </header>';i.val(c+"-"+r+"-"+u+" 09:00"),o.val(c+"-"+r+"-"+u+" 18:00"),l(),i.datetimePicker({toolbarTemplate:p,onChange:function(t,e,a){n(t);var l=([].concat(i.val().split(" ")[0].split("-"),i.val().split(" ")[1].split(":")),e),s=[].concat(o.val().split(" ")[0].split("-"),o.val().split(" ")[1].split(":"));l[0]==s[0]?l[1]==s[1]?l[2]==s[2]?l[3]==s[3]?l[4]>s[4]&&t.cols[6].setValue(s[4]):l[3]>s[3]&&t.cols[4].setValue(s[3]):l[2]>s[2]&&t.cols[2].setValue(s[2]):l[1]>s[1]&&t.cols[1].setValue(s[1]):l[0]>s[0]&&t.cols[0].setValue(s[0])},onOpen:function(t){i.timer=setInterval(l,1e3)},onClose:function(t){clearInterval(i.timer)}}),o.datetimePicker({toolbarTemplate:p,onChange:function(t,e,a){n(t);var l=([].concat(o.val().split(" ")[0].split("-"),o.val().split(" ")[1].split(":")),e),s=[].concat(i.val().split(" ")[0].split("-"),i.val().split(" ")[1].split(":"));l[0]==s[0]?l[1]==s[1]?l[2]==s[2]?l[3]==s[3]?l[4]<s[4]&&t.cols[6].setValue(s[4]):l[3]<s[3]&&t.cols[4].setValue(s[3]):l[2]<s[2]&&t.cols[2].setValue(s[2]):l[1]<s[1]&&t.cols[1].setValue(s[1]):l[0]<s[0]&&t.cols[0].setValue(s[0])},onOpen:function(t){o.timer=setInterval(l,1e3)},onClose:function(t){clearInterval(o.timer)}})},this.handleSubmit=function(t){$("#"+t+" .app-submit a").on("click",function(e){$.ajax({url:"../../resources/json/detailSubmit.json",type:"POST",data:{type:$("#"+t+" .app-leave-type .item-after").text(),startTime:$("#"+t+" .app-leave-start-time input").val(),endTime:$("#"+t+" .app-leave-end-time input").val(),reason:$("#"+t+" .app-leave-reason input").val()},success:function(t){1==t.status&&history.back()}})})}}return new e});