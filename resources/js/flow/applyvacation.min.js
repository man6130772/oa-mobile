define(["vue","webuploader","swipeout","css!webuploadercss","css!iconfont","css!commoncss","css!leftdetailsCSS","css!applyvacationCSS","vue.template"],function(e,i){function t(){var t,a,n,o=this;this.init=function(e,i,n){t=e.type,o.handleBackClick(),a="pageReinit"===t?a:o.renderForm("flowForm"),o.ajaxData("../../resources/json/applyvacation.json",a,o.handleImgUpload),o.handleSubmit(i);var s=o.render("flowState");o.ajaxData("../../resources/json/flowState.json",s)},this.render=function(i,t){return new e({el:"#"+i,data:{data:t||{}}})},this.renderForm=function(i,t){return new e({el:"#"+i,data:{data:t||{}},updated:function(){$(document).off($.touchEvents.start,".list-block li.swipeout"),$(document).off($.touchEvents.move,".list-block li.swipeout"),$(document).off($.touchEvents.end,".list-block li.swipeout"),$.initSwipeout();var e=this;$(document).off("deleted",".list-block li.swipeout").on("deleted",".list-block li.swipeout",function(i){e.data.leftDetails=[],$.ajax({url:"../../resources/json/applyvacation.json",type:"POST",data:{delete:$(this).find(".item-title").text()},success:function(i){e.data=i}})})}})},this.ajaxData=function(e,i,t){$.getJSON(e,function(e){i.data=e,t&&t(i,e)})},this.handleBackClick=function(){$(".app-btn-back").off("click").on("click",function(){history.back()})},this.handleSubmit=function(e){$("#"+e+" .app-submit").off("click").on("click",function(){var i=$("#"+e+" .imguploader").data("uploader");i&&i.upload()})},this.handleTimerBack=function(){return void $.modal({text:'<span class="iconfont icon-dui color-limegreen icon-big p-r-sm"></span>提交成功！',afterText:'<p class="app-modal-remarks"><span id="backCount" class="color-red">2</span> 秒后跳转【创建流程】</p>'})},this.handleImgUpload=function(e){if(!n||"pageReinit"!==t){var a=n=$(e.$el).find(".imguploader"),s=$('<div class="upitem iconfont icon-xiangji"></div>').appendTo(a),c=i.create({auto:!1,prepareNextFile:!0,duplicate:!0,chunked:!0,server:"http://172.17.194.42:8088/BelleOA_Moblie_0.1/uploadImage.do",pick:s[0],accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},compress:{width:1600,height:1600,quality:80,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!1,compressSize:0},withCredentials:!0});a.data("uploader",c),c.on("fileQueued",function(e){var i=$('<div class="imgitem"><img id="'+e.id+'"><i class="iconfont icon-cha"></i></div>'),t=i.find("img"),a=i.find("i");s.before(i),c.makeThumb(e,function(e,i){if(e)return void t.replaceWith("<span>不能预览</span>");t.attr("src",i)},i.width(),i.height()),a.on("click",function(){c.removeFile(e),i.remove()})}),c.on("uploadSuccess",function(e,i){$("#"+e.id).parent(".imgitem").removeClass("upload-fail").addClass("upload-success");var t=c.getStats(),a=n.find(".imgitem").length;0===t.progressNum&&0===t.queueNum&&t.successNum===a&&o.handleTimerBack()}),c.on("uploadError",function(e,i){$("#"+e.id).parent(".imgitem").removeClass("upload-success").addClass("upload-fail")})}}}return new t});