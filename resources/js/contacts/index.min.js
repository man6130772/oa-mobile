define(["vue","css!iconfont","css!commoncss","css!contactsIndexCSS","common","vue.template"],function(t){function n(){var n,a,e,i,o=this,r=r||[],c=function(t,n){var a,e,i,o,r=0,c=function(){r=new Date,i=null,o=t.apply(a,e)};return function(){var s=new Date,l=n-(s-r);return a=this,e=arguments,l<=0?(clearTimeout(i),i=null,r=s,o=t.apply(a,e)):i||(i=setTimeout(c,l)),o}},s=function(t,n){for(var a=-1,e=0,i=null==t?0:t.length,o=[];++a<i;){var r=t[a];n(r,a,t)&&(o[e++]=r)}return o};this.init=function(t){e=t.type,"pageInit"==e&&$.showIndicator(),a="pageReinit"==e?a:o.render("contactsList"),"pageInit"==e&&o.getCurrVersion(),"pageInit"==e&&o.contactsSearch()},this.render=function(n,a){return new t({el:"#"+n,data:{data:a||{}}})},this.getCurrVersion=function(){ajaxData("GET",ajaxUrl.contactsListVersion,function(t){currVersion=t.version,console.log(currVersion),o.checkVersion()})},this.checkVersion=function(t){i=localStorage.getItem("conListVersion")||"",i||i===t?(console.log("这里是从缓存中获取数据"),o.getCacheData(a)):(console.log("这里是重新获取数据"),"pageInit"==e&&o.ajaxData(ajaxUrl.contactsList,a))},this.ajaxData=function(t,a){ajaxData("GET",t,function(t){$.hideIndicator(),a.data=t,n=t,a.$nextTick(function(){$(".contacts-block").indexList()}),o.getListArr(),localStorage.setItem("conListVersion",currVersion);var e={obj:n,arr:r};localStorage.setItem("listData",JSON.stringify(e))})},this.getCacheData=function(t){console.log(localStorage.getItem("listData").length);var a=JSON.parse(localStorage.getItem("listData"));$.hideIndicator(),n=a.obj,r=a.arr,t.data=n,t.$nextTick(function(){$(".contacts-block").indexList()})},this.contactsSearch=function(){$("#search").on("input",c(function(){var t=$(this).val().toLowerCase();o.filterData(t)},200))},this.filterData=function(t){var e=function(n){var a=n.name,e=n.first;return a.indexOf(t)>-1||e.indexOf(t)>-1};t?(a.data=s(r,e),$(".index-list-bar").hide()):(a.data=n,$(".index-list-bar").show())},this.getListArr=function(){for(var t in n)for(var a=n[t],e=a.length,i=0;i<e;i++)r.push(a[i]);console.log("allListArr.length",r.length)}}return new n});